<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <!-- mapper
  	namespace란?
  	mapper 파일이 여러개일때, 해당하는 파일을 식별할 수 있는 식별자
  	이름을 정해줄때, 해당 mapper파일과 연결이 되는 DAO 쿨래스 이름을
  	일치 시켜주는 것을 원칙으로 함
   -->


<mapper namespace="com.smhrd.products.model.ProductImageDTO">

	<!-- 이미지 SQL ============================================================================================================ -->
	<insert id="ProductImageUpload" parameterType="java.util.ArrayList">
	    <foreach collection="list" item="arr" index="index" separator=" " open="INSERT ALL" close="SELECT * FROM DUAL">
	        INTO PROD_UPLOAD_IMAGES (
	            PROD_ID,
	            FILE_NAME,
	            FILE_REALNAME,
	            FILE_SIZE,
	            FILE_EXT,
	            FILE_PATH
	        ) VALUES (
	            #{arr.prod_id},
	            #{arr.file_name},
	            CONCAT(TO_CHAR(SYSDATE, 'YYMMDD_HH24MISS'), #{arr.file_name}),
	            #{arr.prodFile_size},
	            #{arr.prodFile_ext},
	            #{arr.prodFile_path}
	        )
	    </foreach>
	</insert>

	
	<!-- 상품 이미지 조회 -->
	<select id="selectImages" parameterType="com.smhrd.products.model.ProductImageDTO" resultType="com.smhrd.products.model.ProductImageDTO">
		SELECT *
		FROM PROD_UPLOAD_IMAGES
		WHERE PROD_ID = #{prod_id}
	</select>
	
	<!-- 메인 상품 이미지 조회 -->
	<select id="selectImageMain" resultType="com.smhrd.products.model.ProductImageDTO">
		SELECT A.PROD_ID, A.PROD_PRICE, A.PROD_NAME, A.PROD_GRADE,  B.FILE_NAME
		FROM    PRODUCTS A, PROD_UPLOAD_IMAGES B 
		WHERE  FILE_MAIN= 'Y'
		AND A.PROD_ID = B.PROD_ID
	</select>

</mapper>